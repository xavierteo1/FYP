<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Apply to be SwapMates | Clothes Swap</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Global Design System -->
  <link href="/css/global-design.css" rel="stylesheet">

  <style>
    .navbar-brand{
      font-weight:700;
      letter-spacing:.08em;
      text-transform:uppercase;
      font-size:1rem;
    }
    .brand-red{ color:#e60000; }

    .wrap{
      max-width: 760px;
      margin: 0 auto;
      padding: 18px 12px 60px;
    }

    .card-soft{
      border-radius:18px;
      border:none;
      background:#fff;
      box-shadow: 0 10px 25px rgba(15,23,42,0.08);
    }

    .pill-status{
      border-radius:999px;
      padding: .18rem .60rem;
      font-size:.78rem;
      font-weight:700;
      display:inline-block;
    }
    .pill-submitted{ background:#e0f2fe; color:#0369a1; }
    .pill-review{ background:#fef9c3; color:#92400e; }
    .pill-approved{ background:#dcfce7; color:#166534; }
    .pill-rejected{ background:#fee2e2; color:#b91c1c; }

    .help-text{ color:#6b7280; font-size:.88rem; }
    .tiny{ color: rgba(0,0,0,.55); font-size:.85rem; }

    /* Frutiger Metro Dynamic Background */
    body {
        background: linear-gradient(45deg, #E8F4F8, #F0E8F8, #F8F0E8, #E8F8F0, #F8F0F0, #E8F4F8);
        background-size: 400% 400%;
        animation: metro-flow 30s ease infinite;
        position: relative;
        min-height: 100vh;
        overflow-x: hidden;
        color: #333;
    }
    
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: 
            linear-gradient(90deg, rgba(0, 120, 215, 0.12) 0%, transparent 30%, transparent 70%, rgba(0, 120, 215, 0.12) 100%),
            linear-gradient(180deg, rgba(255, 140, 0, 0.08) 0%, transparent 40%, transparent 60%, rgba(255, 140, 0, 0.08) 100%),
            linear-gradient(45deg, rgba(107, 142, 35, 0.1) 0%, transparent 50%, transparent 50%, rgba(107, 142, 35, 0.1) 100%);
        animation: metro-grid 20s ease-in-out infinite;
        pointer-events: none;
        z-index: 0;
    }

    body::after {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: 
            linear-gradient(90deg, transparent 0%, rgba(0, 120, 215, 0.05) 25%, rgba(0, 120, 215, 0.05) 75%, transparent 100%),
            linear-gradient(0deg, transparent 0%, rgba(255, 140, 0, 0.04) 50%, transparent 100%);
        background-size: 200% 100%, 100% 200%;
        animation: metro-slide 25s ease-in-out infinite;
        pointer-events: none;
        z-index: 0;
    }

    @keyframes metro-flow {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    @keyframes metro-grid {
        0%, 100% { transform: scale(1) translateY(0); filter: brightness(1); }
        25% { transform: scale(1.02) translateY(-5px); filter: brightness(1.03); }
        50% { transform: scale(1.01) translateY(-10px); filter: brightness(1.05); }
        75% { transform: scale(1.02) translateY(-5px); filter: brightness(1.03); }
    }

    @keyframes metro-slide {
        0%, 100% { background-position: 0% 0%, 0% 0%; }
        50% { background-position: 100% 0%, 0% 100%; }
    }

    body > * {
        position: relative;
        z-index: 1;
    }
  </style>
</head>

<body>

<!-- NAVBAR (same as your homepage) -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
  <div class="container">
    <a class="navbar-brand" href="/">
      <span class="brand-red">CLOTHES</span> SWAP
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="mainNavbar">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link" href="/">Home</a>
        </li>

        <% if (user) { %>
          <li class="nav-item"><a class="nav-link" href="/wardrobe">Wardrobe</a></li>
          <li class="nav-item"><a class="nav-link" href="/swap">Swap</a></li>
          <li class="nav-item"><a class="nav-link" href="/sahm">SwapMates</a></li>
          <li class="nav-item"><a class="nav-link" href="/profile">Profile</a></li>
          <li class="nav-item ms-lg-3">
            <a class="btn btn-sm" style="background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%); color: white; border: none; border-radius: 10px; font-weight: 700; padding: 0.5rem 1.2rem; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(45, 90, 79, 0.2);" href="/logout" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(45, 90, 79, 0.3)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(45, 90, 79, 0.2)';">Logout</a>
          </li>
        <% } else { %>
          <li class="nav-item ms-lg-3">
            <a class="btn btn-sm btn-outline-danger" href="/login">Sign In</a>
          </li>
        <% } %>
      </ul>
    </div>
  </div>
</nav>

<div class="wrap">

  <!-- Flash messages -->
  <div class="mt-3">
    <% if (typeof success_msg !== 'undefined' && success_msg && success_msg.length > 0) { %>
      <div class="alert alert-success" style="border-radius:12px;"><%= success_msg %></div>
    <% } %>
    <% if (typeof error_msg !== 'undefined' && error_msg && error_msg.length > 0) { %>
      <div class="alert alert-danger" style="border-radius:12px;"><%= error_msg %></div>
    <% } %>
  </div>

  <div class="card-soft p-3 p-md-4 mt-3">
    <div class="d-flex align-items-start justify-content-between gap-3 flex-wrap">
      <div>
        <h3 class="fw-bold mb-1">Apply to be a SwapMates</h3>
        <div class="help-text">
          Upload your <b>resume</b> and <b>identity verification</b> (IC photo) as a single file (PDF/ZIP recommended).
        </div>
      </div>
      <div class="text-end">
        <a href="/" class="btn btn-sm btn-outline-secondary rounded-pill">Back</a>
      </div>
    </div>

    <hr class="my-3"/>

    <!-- Current application status block -->
    <div class="mb-3">
      <div class="fw-semibold mb-1">Your application status</div>

      <% if (!application) { %>
        <div class="tiny">No application submitted yet.</div>

      <% } else { %>
        <div class="d-flex align-items-center gap-2 flex-wrap">
          <% if (application.status === 'submitted') { %>
            <span class="pill-status pill-submitted">Submitted</span>
          <% } else if (application.status === 'under_review') { %>
            <span class="pill-status pill-review">Under review</span>
          <% } else if (application.status === 'approved') { %>
            <span class="pill-status pill-approved">Approved</span>
          <% } else if (application.status === 'rejected') { %>
            <span class="pill-status pill-rejected">Rejected</span>
          <% } else { %>
            <span class="pill-status pill-submitted"><%= application.status %></span>
          <% } %>

          <span class="tiny">
            <% if (application.created_at) { %>
              Submitted: <%= application.created_at.toLocaleString ? application.created_at.toLocaleString() : application.created_at %>
            <% } %>
            <% if (application.updated_at) { %>
              · Updated: <%= application.updated_at.toLocaleString ? application.updated_at.toLocaleString() : application.updated_at %>
            <% } %>
          </span>
        </div>

        <% if (application.document_url) { %>
          <div class="mt-2 tiny">
            Document: <a href="<%= application.document_url %>" target="_blank">View upload</a>
          </div>
        <% } %>

        <% if (application.admin_comment) { %>
          <div class="alert alert-info mt-3" style="border-radius:12px;">
            <div class="fw-semibold mb-1">Admin comment</div>
            <div><%= application.admin_comment %></div>
          </div>
        <% } %>

      <% } %>
    </div>

    <%
      const status = application ? application.status : null;
      const hasActive = status && (status === 'submitted' || status === 'under_review' || status === 'approved');
    %>

    <!-- Apply form -->
    <% if (!hasActive) { %>
      <form action="/sahm/apply" method="POST" enctype="multipart/form-data" class="mt-3">
        <div class="mb-2">
          <label class="form-label fw-semibold">Upload document</label>
          <input
            type="file"
            name="document"
            class="form-control"
            accept=".pdf,.zip,.png,.jpg,.jpeg"
            required
          />
          <div class="help-text mt-1">
            Recommended: 1 PDF or ZIP containing your resume + IC images.
          </div>
        </div>

        <button type="submit" class="btn btn-danger rounded-pill px-4">
          Submit Application
        </button>

        <div class="tiny mt-3">
          By submitting, you agree that this information is used only for verifying SwapMates eligibility.
        </div>
      </form>

    <% } else { %>
      <div class="alert alert-light mt-3" style="border-radius:12px;">
        <div class="fw-semibold mb-1">Application already in progress</div>
        <div class="tiny">
          You already have an application with status: <b><%= status %></b>.  
          Please wait for admin review.
        </div>

        <% if (status === 'approved') { %>
          <div class="mt-2">
            <a href="/sahm" class="btn btn-sm btn-danger rounded-pill">Go to SwapMates</a>
          </div>
        <% } %>
      </div>
    <% } %>

  </div>

  <div class="tiny text-center mt-3">
    Tip: If you don’t see your upload link, refresh the page after submitting.
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
